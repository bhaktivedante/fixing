<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fixing Up - Registro</title>
    <link rel="stylesheet" href="styles/styles.css" />
  </head>
  <body>
    <div class="register-container">
      <img src="imges/logo.png" alt="Fixing Up Logo" class="logo-img" />
      <h2>Registro de Usuario</h2>
      <form id="register-form" onsubmit="registerFunction(event)">
        <div class="form-group">
          <label for="name">Nombre</label>
          <input
            type="text"
            id="name"
            name="name"
            placeholder="Ingresa tu nombre"
            required
          />
          <small class="error-message" id="name-error"></small>
        </div>

        <div class="form-group">
          <label for="rut">RUT</label>
          <input
            type="text"
            id="rut"
            name="rut"
            placeholder="Ingresa tu RUT"
            required
          />
          <small class="error-message" id="rut-error"></small>
        </div>

        <div class="form-group">
          <label for="email">Correo Electrónico</label>
          <input
            type="email"
            id="email"
            name="email"
            placeholder="Ingresa tu correo"
            required
          />
          <small class="error-message" id="email-error"></small>
        </div>

        <div class="form-group">
          <label for="password">Contraseña</label>
          <input
            type="password"
            id="password"
            name="password"
            placeholder="Ingresa tu contraseña"
            required
          />
          <small class="error-message" id="password-error"></small>
        </div>

        <div class="form-group">
          <label for="confirm-password">Confirmar Contraseña</label>
          <input
            type="password"
            id="confirm-password"
            name="confirm-password"
            placeholder="Confirma tu contraseña"
            required
          />
          <small class="error-message" id="confirm-password-error"></small>
        </div>

        <div class="form-group">
          <label for="role">Rol</label>
          <select
            id="role"
            name="role"
            required
            onchange="toggleProfessionalFields(this.value)"
          >
            <option value="">Selecciona tu rol</option>
            <option value="cliente">Cliente</option>
            <option value="profesional">Profesional</option>
            <option value="administrador">Administrador</option>
          </select>
          <small class="error-message" id="role-error"></small>
        </div>

        <!-- Campos adicionales para profesionales -->
        <div id="professional-fields" style="display: none">
          <div class="form-group">
            <label for="especialidad">Especialidad</label>
            <input
              type="text"
              id="especialidad"
              name="especialidad"
              placeholder="Ej. Plomería"
            />
            <small class="error-message" id="especialidad-error"></small>
          </div>

          <div class="form-group">
            <label for="tarifa_hora">Tarifa por Hora</label>
            <input
              type="number"
              id="tarifa_hora"
              name="tarifa_hora"
              placeholder="Ej. 25"
              min="1"
            />
            <small class="error-message" id="tarifa_hora-error"></small>
          </div>

          <div class="form-group">
            <label for="disponibilidad">Disponibilidad</label>
            <input
              type="text"
              id="disponibilidad"
              name="disponibilidad"
              placeholder="Ej. Lunes a Viernes, 9 AM - 5 PM"
            />
            <small class="error-message" id="disponibilidad-error"></small>
          </div>
        </div>

        <button type="submit">Registrarse</button>
        <p id="register-error" class="error-message"></p>
      </form>
    </div>

    <script>
      // Función para mostrar u ocultar los campos de profesional
      function toggleProfessionalFields(role) {
        const professionalFields = document.getElementById(
          "professional-fields"
        );
        if (role === "profesional") {
          professionalFields.style.display = "block";
        } else {
          professionalFields.style.display = "none";
        }
      }

      // Función de registro (implementación en register.js)
      async function registerFunction(event) {
        event.preventDefault();
        const formData = new FormData(document.getElementById("register-form"));

        // Crear el objeto con los datos del formulario
        const data = {
          nombre: formData.get("name"),
          rut: formData.get("rut"),
          email: formData.get("email"),
          contraseña: formData.get("password"),
          confirmarContraseña: formData.get("confirm-password"),
          rol: formData.get("role"),
        };

        // Agregar datos adicionales si el rol es profesional
        if (data.rol === "profesional") {
          data.especialidad = formData.get("especialidad");
          data.tarifa_hora = formData.get("tarifa_hora");
          data.disponibilidad = formData.get("disponibilidad");
        }

        // Validar campos y enviar al servidor (la lógica está en register.js)
        registerUser(data);
      }
    </script>

    <script src="js/register.js"></script>
    <script src="js/api.js"></script>
  </body>
</html>
